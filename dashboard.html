<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX TAE Trading Dashboard | Professional Trading Journal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="loader-content">
            <h2>FX TAE 1% TRADING CIRCLE</h2>
            <p>Loading Professional Trading Dashboard...</p>
            <div class="progress-bar">
                <div class="progress"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-left">
                <button class="menu-btn" id="menuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h1>FX TAE <span>1% CIRCLE</span></h1>
                </div>
            </div>
            
            <div class="nav-right">
                <div class="date-display" id="currentDate"></div>
                <div class="account-balance-display">
                    <span class="balance-label">Balance:</span>
                    <span class="balance-value" id="accountBalance">$0.00</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <p class="user-name" id="userName">Trader</p>
                        <p class="user-email" id="userEmail">trader@example.com</p>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <ul class="nav-menu">
                <li><a href="#" class="nav-item active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#" class="nav-item" data-page="journal"><i class="fas fa-book"></i> Trade Journal</a></li>
                <li><a href="#" class="nav-item" data-page="analytics"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="#" class="nav-item" data-page="notebook"><i class="fas fa-cloud"></i> Dream Notebook</a></li>
                <li><a href="#" class="nav-item" data-page="community"><i class="fas fa-users"></i> Community</a></li>
                <li><a href="#" class="nav-item" data-page="resources"><i class="fas fa-link"></i> Resources</a></li>
                <li><a href="#" class="nav-item" data-page="motivation"><i class="fas fa-fire"></i> Motivation</a></li>
                <li><a href="#" class="nav-item" data-page="settings"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="#" class="nav-item" data-page="contact"><i class="fas fa-envelope"></i> Contact</a></li>
            </ul>
            
            <div class="sidebar-footer">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <section class="page active" id="dashboard">
                <!-- Mentorship Banner -->
                <div class="mentorship-banner">
                    <h3><i class="fas fa-crown"></i> JOIN THE 1% TRADING CIRCLE</h3>
                    <a href="https://fxtaetrader.page.gd/" class="join-1percent-btn" target="_blank">
                        <i class="fas fa-rocket"></i> JOIN NOW
                    </a>
                </div>

                <div class="page-header">
                    <h2>Professional Trading Dashboard</h2>
                    <button class="export-btn" onclick="exportDashboardPDF()">
                        <i class="fas fa-file-pdf"></i> Export Dashboard PDF
                    </button>
                </div>

                <!-- Performance Stats -->
                <div class="stats-grid">
                    <div class="stat-card blue-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-day"></i> Today's P&L</h3>
                            <div class="stat-actions">
                                <button class="edit-trades-btn" onclick="editTodayTrades()">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="download-btn" onclick="downloadTodayStats()">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stat-value" id="todayPnl">$0.00</div>
                        <div class="stat-details" id="todayTradesList">No trades today</div>
                        <div class="stat-change">Start trading to see performance</div>
                    </div>

                    <div class="stat-card purple-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-exchange-alt"></i> Today's Trades</h3>
                            <div class="stat-actions">
                                <button class="edit-trades-btn" onclick="editTodayTrades()">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stat-value" id="todayTradesCount">0/4</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span>0% Daily Limit</span>
                        </div>
                    </div>

                    <div class="stat-card green-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-week"></i> Weekly Performance</h3>
                            <div class="stat-actions">
                                <button class="download-btn" onclick="downloadWeeklyStats()">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stat-value" id="weeklyPnl">$0.00</div>
                        <div class="stat-details" id="weeklyTradesList">No weekly trades</div>
                        <div class="stat-change">Weekly performance will appear here</div>
                    </div>

                    <div class="stat-card orange-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-alt"></i> Monthly Performance</h3>
                            <div class="stat-actions">
                                <button class="download-btn" onclick="downloadMonthlyStats()">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                       <div class="stat-value" id="monthlyPnl">$0.00</div>
                        <div class="stat-details" id="monthlyTradesList">No monthly trades</div>
                        <div class="stat-change">Monthly performance will appear here</div>
                    </div>
                </div>

                <!-- Account Balance Manager -->
                <div class="balance-manager-card">
                    <div class="section-header">
                        <h3><i class="fas fa-wallet"></i> Account Balance Manager</h3>
                    </div>
                    
                    <div class="balance-form">
                        <div class="balance-input-group">
                            <label><i class="fas fa-dollar-sign"></i> Current Balance ($)</label>
                            <div class="input-with-icon">
                                <span class="input-icon">$</span>
                                <input type="number" id="currentBalanceInput" class="form-input" placeholder="Enter current balance" readonly>
                            </div>
                            <p class="balance-note">Auto-updated from trades</p>
                        </div>
                        
                        <div class="balance-stats">
                            <div class="balance-stat">
                                <div class="balance-stat-header">
                                    <span class="stat-label">Starting Balance</span>
                                    <button class="edit-starting-balance-btn" onclick="editStartingBalance()" title="Edit Starting Balance">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                <div class="balance-stat-content">
                                    <span class="stat-value" id="startingBalance">$10,000.00</span>
                                    <input type="number" id="startingBalanceInput" class="edit-input" style="display: none;" placeholder="Enter new starting balance" step="0.01" min="0">
                                </div>
                                <div class="edit-buttons">
                                    <button id="saveBalanceBtn" class="save-balance-btn" onclick="saveStartingBalance()" style="display: none;">
                                        <i class="fas fa-check"></i> Save
                                    </button>
                                    <button id="cancelBalanceBtn" class="cancel-balance-btn" onclick="cancelStartingBalanceEdit()" style="display: none;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="balance-stat">
                                <span class="stat-label">Total Growth</span>
                                <span class="stat-value" id="totalGrowth">$0.00</span>
                            </div>
                            <div class="balance-stat">
                                <span class="stat-label">Growth %</span>
                                <span class="stat-value" id="growthPercentage">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Equity Curve</h3>
                            <div class="chart-period">
                                <button class="period-btn active" data-period="7d" onclick="updateChartPeriod('7d')">7D</button>
                                <button class="period-btn" data-period="1m" onclick="updateChartPeriod('1m')">1M</button>
                                <button class="period-btn" data-period="12m" onclick="updateChartPeriod('12m')">12M</button>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="equityChart"></canvas>
                        </div>
                        <div class="chart-download-btn">
                            <button class="btn-secondary" onclick="downloadChartAsPDF('equityChart', 'Equity_Curve')">
                                <i class="fas fa-download"></i> Download Chart
                            </button>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Win Rate Analysis</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="winRateValue">0%</span>
                                <span class="rate-label">Win Rate</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winRateChart"></canvas>
                        </div>
                        <div class="chart-download-btn">
                            <button class="btn-secondary" onclick="downloadChartAsPDF('winRateChart', 'Win_Rate_Analysis')">
                                <i class="fas fa-download"></i> Download Chart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Trade Entry -->
                <div class="trade-entry-card">
                    <div class="section-header">
                        <h3><i class="fas fa-bolt"></i> Quick Trade Entry</h3>
                        <button class="btn-secondary" onclick="saveAndDownloadTrade()">
                            <i class="fas fa-save"></i> Save & Download
                        </button>
                    </div>
                    
                    <form class="trade-form" id="tradeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="far fa-calendar"></i> Date</label>
                                <input type="date" id="tradeDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label><i class="far fa-clock"></i> Time</label>
                                <input type="time" id="tradeTime" class="form-input" value="09:30" required>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-hashtag"></i> Trade # (1-4)</label>
                                <select id="tradeNumber" class="form-input" required>
                                    <option value="1">Trade 1</option>
                                    <option value="2">Trade 2</option>
                                    <option value="3">Trade 3</option>
                                    <option value="4">Trade 4</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-chess-knight"></i> Strategy</label>
                                <div class="strategy-input-group">
                                    <select id="strategy" class="form-input" required>
                                        <option value="Breakout">Breakout Trading</option>
                                        <option value="Trend">Trend Following</option>
                                        <option value="Scalping">Scalping</option>
                                        <option value="Swing">Swing Trading</option>
                                        <option value="Price Action">Price Action</option>
                                        <option value="News Trading">News Trading</option>
                                        <option value="Supply Demand">Supply & Demand</option>
                                    </select>
                                    <button type="button" class="btn-secondary" onclick="showCustomStrategy()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <input type="text" id="customStrategy" class="form-input" style="display: none; margin-top: 0.5rem;" placeholder="Enter custom strategy name">
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-globe"></i> Currency Pair / Instrument</label>
                                <select id="currencyPair" class="form-input" required>
                                    <optgroup label="Major Forex">
                                        <option value="EUR/USD">EUR/USD</option>
                                        <option value="GBP/USD">GBP/USD</option>
                                        <option value="USD/JPY">USD/JPY</option>
                                        <option value="AUD/USD">AUD/USD</option>
                                        <option value="USD/CAD">USD/CAD</option>
                                        <option value="NZD/USD">NZD/USD</option>
                                        <option value="USD/CHF">USD/CHF</option>
                                        <option value="EUR/GBP">EUR/GBP</option>
                                        <option value="EUR/JPY">EUR/JPY</option>
                                        <option value="GBP/JPY">GBP/JPY</option>
                                    </optgroup>
                                    <optgroup label="Metals">
                                        <option value="XAU/USD">XAU/USD (Gold)</option>
                                        <option value="XAG/USD">XAG/USD (Silver)</option>
                                    </optgroup>
                                    <optgroup label="Indices">
                                        <option value="US30">US30 (Dow Jones)</option>
                                        <option value="NAS100">NAS100 (Nasdaq)</option>
                                        <option value="SPX500">SPX500 (S&P 500)</option>
                                    </optgroup>
                                    <optgroup label="Crypto">
                                        <option value="BTC/USD">BTC/USD (Bitcoin)</option>
                                        <option value="ETH/USD">ETH/USD (Ethereum)</option>
                                    </optgroup>
                                    <optgroup label="Commodities">
                                        <option value="USOIL">USOIL (Crude Oil)</option>
                                        <option value="UKOIL">UKOIL (Brent Oil)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-coins"></i> P&L ($)</label>
                                <div class="input-with-icon">
                                    <span class="input-icon">$</span>
                                    <input type="number" step="0.01" id="pnlAmount" class="form-input" placeholder="Enter amount" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-sticky-note"></i> Notes</label>
                                <input type="text" id="tradeNotes" class="form-input" placeholder="Trade setup, emotions, lessons...">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-primary" onclick="saveTrade()">
                                <i class="fas fa-save"></i> Save Trade
                            </button>
                            <button type="button" class="btn-secondary" onclick="saveAndDownloadTrade()">
                                <i class="fas fa-download"></i> Save & Download PDF
                            </button>
                            <button type="reset" class="btn-outline">
                                <i class="fas fa-redo"></i> Clear Form
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Recent Trades -->
                <div class="recent-trades-card">
                    <div class="section-header">
                        <h3><i class="fas fa-history"></i> Recent Trades</h3>
                        <button class="edit-trades-btn" onclick="editTodayTrades()">
                            <i class="fas fa-edit"></i> Edit Today's Trades
                        </button>
                    </div>
                    <div class="trades-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Trade #</th>
                                    <th>Pair</th>
                                    <th>Strategy</th>
                                    <th>P&L</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentTradesTable">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Journal Page -->
            <section class="page" id="journal">
                <div class="page-header">
                    <h2>Trade Journal</h2>
                    <button class="export-btn" onclick="exportJournalPDF()">
                        <i class="fas fa-file-pdf"></i> Export Journal PDF
                    </button>
                </div>
                <div class="trades-table full-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Trade #</th>
                                <th>Pair</th>
                                <th>Strategy</th>
                                <th>P&L</th>
                                <th>Notes</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allTradesTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Analytics Page -->
            <section class="page" id="analytics">
                <div class="page-header">
                    <h2>Advanced Analytics</h2>
                    <button class="export-btn" onclick="exportAnalyticsPDF()">
                        <i class="fas fa-chart-bar"></i> Export Analytics PDF
                    </button>
                </div>
                
                <div class="analytics-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Winning vs Losing</h3>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winLossChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Win/Loss Ratio</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="winLossRatioValue">0:0</span>
                                <span class="rate-label">Win:Loss Ratio</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winLossRatioChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-calendar-alt"></i> Daily P&L Calendar</h3>
                        </div>
                        <div class="calendar-container">
                            <div class="calendar-controls">
                                <button onclick="changeCalendarMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                <span id="calendarMonth">January 2024</span>
                                <button onclick="changeCalendarMonth(1)"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notebook Page -->
            <section class="page" id="notebook">
                <div class="page-header">
                    <h2>Notebook</h2>
                </div>
                
                <div class="notebook-container">
                    <div class="dream-input-group">
                        <label><i class="fas fa-pen"></i> Write Your Trading Dreams & Goals</label>
                        <textarea id="dreamInput" placeholder="Write your trading dreams, goals, and aspirations here. Be specific about what you want to achieve..."></textarea>
                        <div class="form-actions">
                            <button class="btn-primary" onclick="saveDream()">
                                <i class="fas fa-save"></i> Save Dream 
                            </button>
                            <button class="btn-secondary" onclick="clearDream()">
                                <i class="fas fa-redo"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div class="dreams-list" id="dreamsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Community Page -->
            <section class="page" id="community">
                <div class="page-header">
                    <h2>Join Our Community</h2>
                </div>
                
                <div class="community-grid">
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <h3>Telegram Group</h3>
                        <p>Join our active Telegram community for daily market analysis, trade ideas, and discussions with fellow traders.</p>
                        <a href="https://t.me/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-telegram"></i> Join Telegram
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <h3>YouTube Channel</h3>
                        <p>Subscribe to our YouTube channel for educational content, live trading sessions, and market insights.</p>
                        <a href="https://www.youtube.com/@fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-youtube"></i> Subscribe
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <h3>Instagram</h3>
                        <p>Follow us on Instagram for trading psychology tips, daily motivation, and behind-the-scenes content.</p>
                        <a href="https://instagram.com/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-instagram"></i> Follow
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-tiktok"></i>
                        </div>
                        <h3>TikTok</h3>
                        <p>Watch short, engaging trading tips and market analysis on our TikTok channel.</p>
                        <a href="https://tiktok.com/@fx_tae_trader" class="community-btn" target="_blank">
                            <i class="fab fa-tiktok"></i> Follow
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-facebook"></i>
                        </div>
                        <h3>Facebook</h3>
                        <p>Connect with us on Facebook for community events, live Q&A sessions, and trading resources.</p>
                        <a href="https://facebook.com/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-facebook"></i> Like Page
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3>Exclusive Academy</h3>
                        <p>Join our premium trading academy for personalized coaching, advanced strategies, and mentorship.</p>
                        <a href="https://fxtaetrader.page.gd/" class="community-btn academy-btn" target="_blank">
                            <i class="fas fa-rocket"></i> Join Academy
                        </a>
                    </div>
                </div>
            </section>

            <!-- Resources Page -->
            <section class="page" id="resources">
                <div class="page-header">
                    <h2>Trading Resources</h2>
                </div>
                
                <div class="resources-grid">
                    <!-- Brokers -->
                    <div class="resource-card blue-card">
                        <div class="resource-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <h3>Trusted Brokers</h3>
                        <div class="resource-links">
                            <a href="https://one.exnessonelink.com/a/f8t7u25p4e?source=app" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Exness</strong>
                                    <span>Low spreads, fast execution</span>
                                </div>
                            </a>
                            <a href="https://www.xmglobal.com/referral?token=UwkIjT3bocE_ES4g8nXlsA" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>XM Broker</strong>
                                    <span>1000+ instruments</span>
                                </div>
                            </a>
                            <a href="https://www.fbs.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>FBS Broker</strong>
                                    <span>Popular broker worldwide</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Prop Firms -->
                    <div class="resource-card purple-card">
                        <div class="resource-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3>Prop Trading Firms</h3>
                        <div class="resource-links">
                            <a href="https://www.fundednext.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Funded Next</strong>
                                    <span>High payouts, great scaling</span>
                                </div>
                            </a>
                            <a href="https://www.fundingpips.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Funding Pips</strong>
                                    <span>Flexible rules, instant funding</span>
                                </div>
                            </a>
                            <a href="https://www.ftmo.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>FTMO</strong>
                                    <span>Industry leader, 90% profit split</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Analysis Tools -->
                    <div class="resource-card green-card">
                        <div class="resource-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Analysis Tools</h3>
                        <div class="resource-links">
                            <a href="https://www.forexfactory.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Forex Factory</strong>
                                    <span>Economic calendar & news</span>
                                </div>
                            </a>
                            <a href="https://www.babypips.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>BabyPips</strong>
                                    <span>Education & market sentiment</span>
                                </div>
                            </a>
                            <a href="https://www.tradingview.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>TradingView</strong>
                                    <span>Advanced charts & community</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Trading Platforms -->
                    <div class="resource-card orange-card">
                        <div class="resource-icon">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <h3>Trading Platforms</h3>
                        <div class="resource-links">
                            <a href="https://www.metatrader4.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>MetaTrader 4</strong>
                                    <span>Most popular trading platform</span>
                                </div>
                            </a>
                            <a href="https://www.metatrader5.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>MetaTrader 5</strong>
                                    <span>Advanced features</span>
                                </div>
                            </a>
                            <a href="https://www.tradingview.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>TradingView</strong>
                                    <span>Web-based charts & analysis</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Trader Mindset Page -->
            <section class="page" id="motivation">
                <div class="page-header">
                    <h2>Trader's Mindset</h2>
                </div>
                
                <div class="motivation-quote">
                    <i class="fas fa-quote-left"></i>
                    <h3>"The goal of a successful trader is to make the best trades. Money is secondary."</h3>
                    <p>- Alexander Elder</p>
                </div>
                
                <div class="motivation-grid">
                    <div class="motivation-card blue-card">
                        <div class="motivation-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h4>1. Discipline</h4>
                        <p>Stick to your trading plan regardless of emotions. Every trade must follow your rules.</p>
                    </div>
                    
                    <div class="motivation-card purple-card">
                        <div class="motivation-icon">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <h4>2. Patience</h4>
                        <p>Wait for the right setups. The market will always provide opportunities.</p>
                    </div>
                    
                    <div class="motivation-card green-card">
                        <div class="motivation-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h4>3. Psychology</h4>
                        <p>Master your emotions. Fear and greed are your biggest enemies.</p>
                    </div>
                    
                    <div class="motivation-card orange-card">
                        <div class="motivation-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h4>4. Journaling</h4>
                        <p>Record every trade. Review regularly. Learn from both wins and losses.</p>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section class="page" id="settings">
                <div class="page-header">
                    <h2>Settings</h2>
                </div>
                
                <div class="settings-container">
                    <div class="settings-group">
                        <h3><i class="fas fa-palette"></i> Theme Settings</h3>
                        
                        <div class="theme-toggle">
                            <button class="theme-btn active" onclick="setTheme('light')">
                                <i class="fas fa-sun"></i> Light Theme
                            </button>
                            <button class="theme-btn" onclick="setTheme('dark')">
                                <i class="fas fa-moon"></i> Dark Theme
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Trade Reminders</span>
                                <small>Get reminders for trade entries</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="tradeReminders" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Daily Summary</span>
                                <small>Receive daily performance summary</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="dailySummary" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3><i class="fas fa-database"></i> Data Management</h3>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Export All Data (PDF)</span>
                                <small>Download all trades and settings as PDF</small>
                            </div>
                            <button class="btn-secondary" onclick="exportAllDataPDF()">
                                <i class="fas fa-download"></i> Export PDF
                            </button>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Clear All Data</span>
                                <small>Delete all trades and reset account</small>
                            </div>
                            <button class="btn-outline" onclick="clearAllData()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contact Page -->
            <section class="page" id="contact">
                <div class="page-header">
                    <h2>Contact FX Tae</h2>
                </div>
                
                <div class="contact-container">
                    <div class="contact-info">
                        <h3><i class="fas fa-info-circle"></i> Contact Information</h3>
                        
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <h4>Email</h4>
                                <p>fxtae.chartprogram@gmail.com</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <h4>Phone</h4>
                                <p>+256 778997909</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fab fa-whatsapp"></i>
                            <div>
                                <h4>WhatsApp</h4>
                                <p>+256 778997909</p>
                            </div>
                        </div>
                        
                        <h3 class="social-title"><i class="fas fa-share-alt"></i> Social Media</h3>
                        
                        <div class="social-links">
                            <a href="https://www.tiktok.com/@fx_tae_trader" class="social-link" target="_blank">
                                <i class="fab fa-tiktok"></i> @fx_tae_trader
                            </a>
                            
                            <a href="https://www.instagram.com/fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-instagram"></i> @fxtaetrader
                            </a>
                            
                            <a href="https://www.youtube.com/@fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-youtube"></i> @fxtaetrader
                            </a>
                            
                            <a href="https://www.facebook.com/fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-facebook"></i> @FXTaeTrader
                            </a>
                        </div>
                    </div>
                    
                    <div class="mentorship-card">
                        <div class="mentorship-badge">
                            <i class="fas fa-crown"></i> 1% CIRCLE
                        </div>
                        <h3><i class="fas fa-graduation-cap"></i> Join 1% Trading Circle</h3>
                        <p>Ready to level up your trading? Join FX Tae's exclusive mentorship program for personalized coaching, advanced strategies, and direct mentorship.</p>
                        <a href="https://fxtaetrader.page.gd/" class="mentorship-btn" target="_blank">
                            <i class="fas fa-rocket"></i> Apply for Mentorship
                        </a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="editBalanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Account Balance</h3>
                <button class="close-modal" onclick="closeEditBalanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>New Account Balance ($)</label>
                    <input type="number" id="newBalanceInput" class="form-input" placeholder="Enter new balance">
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="confirmBalanceUpdate()">Update Balance</button>
                    <button class="btn-outline" onclick="closeEditBalanceModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="editTradesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Today's Trades</h3>
                <button class="close-modal" onclick="closeEditTradesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="todayTradesEditList"></div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="saveEditedTrades()">Save Changes</button>
                    <button class="btn-outline" onclick="closeEditTradesModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let trades = [];
        let dreams = [];
        let equityChart = null;
        let winRateChart = null;
        let winLossChart = null;
        let winLossRatioChart = null;
        let accountBalance = 0;
        let startingBalance = 0;
        let currentCalendarMonth = new Date().getMonth();
        let currentCalendarYear = new Date().getFullYear();

        // Authentication constants
        const USERS_KEY = 'fxTaeUsers';
        const CURRENT_USER_KEY = 'fxTaeCurrentUser';
        const AUTH_KEY = 'fxTaeAuthenticated';

        // ===== UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            if (amount === null || amount === undefined || isNaN(amount)) return '$0.00';
            return `$${Math.abs(amount).toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })}`;
        }

        function formatCurrencyWithSign(amount) {
            if (amount === null || amount === undefined || isNaN(amount)) return '$0.00';
            const sign = amount >= 0 ? '+' : '-';
            return `${sign}$${Math.abs(amount).toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })}`;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        function formatDateTime(dateString, timeString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                return `${formattedDate} ${timeString || ''}`.trim();
            } catch (error) {
                return dateString;
            }
        }

        function showToast(message, type = 'info') {
            let container = document.getElementById('toastContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toastContainer';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            
            const icon = iconMap[type] || 'info-circle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ===== DATA MANAGEMENT FUNCTIONS =====
        function loadTrades() {
            try {
                const savedTrades = localStorage.getItem('fxTaeTrades');
                trades = savedTrades ? JSON.parse(savedTrades) : [];
            } catch (error) {
                trades = [];
            }
        }

        function loadDreams() {
            try {
                const savedDreams = localStorage.getItem('fxTaeDreams');
                dreams = savedDreams ? JSON.parse(savedDreams) : [];
            } catch (error) {
                dreams = [];
            }
        }

        function loadAccountBalance() {
            try {
                const savedBalance = localStorage.getItem('fxTaeAccountBalance');
                const savedStartingBalance = localStorage.getItem('fxTaeStartingBalance');
                
                if (savedBalance) accountBalance = parseFloat(savedBalance);
                if (savedStartingBalance) startingBalance = parseFloat(savedStartingBalance);
            } catch (error) {
                accountBalance = 0;
                startingBalance = 0;
            }
        }

        function saveTrades() {
            try {
                localStorage.setItem('fxTaeTrades', JSON.stringify(trades));
            } catch (error) {
                showToast('Error saving trades data', 'error');
            }
        }

        function saveDreams() {
            try {
                localStorage.setItem('fxTaeDreams', JSON.stringify(dreams));
            } catch (error) {
                showToast('Error saving dreams data', 'error');
            }
        }

        function saveAccountBalance() {
            try {
                localStorage.setItem('fxTaeAccountBalance', accountBalance.toString());
                localStorage.setItem('fxTaeStartingBalance', startingBalance.toString());
            } catch (error) {
                showToast('Error saving account balance', 'error');
            }
        }

        // ===== MONTHLY RESET FUNCTION =====
        function resetMonthlyData() {
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastReset = localStorage.getItem('fxTaeLastMonthlyReset');
            
            if (!lastReset || new Date(lastReset) < firstDayOfMonth) {
                localStorage.setItem('fxTaeLastMonthlyReset', today.toISOString());
                startingBalance = accountBalance;
                saveAccountBalance();
                
                if (equityChart) {
                    equityChart.data = {
                        labels: ['Starting Balance'],
                        datasets: [{
                            label: 'Account Balance',
                            data: [startingBalance],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    };
                    equityChart.update();
                }
                
                showToast('New month started! Starting balance updated.', 'info');
            }
        }

        // ===== EQUITY CURVE FUNCTIONS =====
        function getEquityData(period = '7d') {
            if (period === '12m') {
                return getEquityData12M();
            }
            
            // Daily view for 7d and 1m periods
            const tradesByDate = {};
            trades.forEach(trade => {
                const date = trade.date;
                if (!tradesByDate[date]) {
                    tradesByDate[date] = 0;
                }
                tradesByDate[date] += trade.pnl;
            });
            
            let filteredDates = Object.keys(tradesByDate);
            const now = new Date();
            
            switch(period.toLowerCase()) {
                case '1m': // 1 month
                    const oneMonthAgo = new Date(now.setMonth(now.getMonth() - 1));
                    filteredDates = filteredDates.filter(date => new Date(date) >= oneMonthAgo);
                    break;
                case '7d': // 7 days (default)
                default:
                    const sevenDaysAgo = new Date(now.setDate(now.getDate() - 7));
                    filteredDates = filteredDates.filter(date => new Date(date) >= sevenDaysAgo);
                    break;
            }
            
            filteredDates.sort((a, b) => new Date(a) - new Date(b));
            
            let balance = startingBalance;
            const data = [balance];
            const labels = ['Starting'];
            
            filteredDates.forEach(date => {
                const dailyPnl = tradesByDate[date];
                balance += dailyPnl;
                data.push(balance);
                
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric'
                });
                
                labels.push(formattedDate);
            });
            
            if (filteredDates.length === 0) {
                return {
                    labels: ['Starting Balance'],
                    datasets: [{
                        label: 'Account Balance',
                        data: [startingBalance],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                };
            }
            
            return {
                labels: labels,
                datasets: [{
                    label: 'Account Balance',
                    data: data,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            };
        }

        function getEquityData12M() {
            const tradesByMonth = {};
            trades.forEach(trade => {
                const date = new Date(trade.date);
                const monthKey = `${date.getFullYear()}-${date.getMonth()}`;
                
                if (!tradesByMonth[monthKey]) {
                    tradesByMonth[monthKey] = {
                        date: new Date(date.getFullYear(), date.getMonth(), 1),
                        pnl: 0
                    };
                }
                tradesByMonth[monthKey].pnl += trade.pnl;
            });
            
            const now = new Date();
            const twelveMonthsAgo = new Date(now.setMonth(now.getMonth() - 12));
            
            const monthlyData = [];
            for (let i = 0; i < 12; i++) {
                const monthDate = new Date(twelveMonthsAgo.getFullYear(), twelveMonthsAgo.getMonth() + i, 1);
                const monthKey = `${monthDate.getFullYear()}-${monthDate.getMonth()}`;
                
                const monthlyPnl = tradesByMonth[monthKey] ? tradesByMonth[monthKey].pnl : 0;
                monthlyData.push({
                    date: monthDate,
                    pnl: monthlyPnl,
                    label: monthDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })
                });
            }
            
            let balance = startingBalance;
            const data = [balance];
            const labels = ['Starting'];
            
            monthlyData.forEach(month => {
                balance += month.pnl;
                data.push(balance);
                labels.push(month.label);
            });
            
            return {
                labels: labels,
                datasets: [{
                    label: 'Account Balance',
                    data: data,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            };
        }

        // ===== WIN/LOSS RATIO CHART FUNCTIONS =====
        function getWinLossRatioData() {
            const winningTrades = trades.filter(t => t.pnl > 0).length;
            const losingTrades = trades.filter(t => t.pnl < 0).length;
            
            const winLossRatioElement = document.getElementById('winLossRatioValue');
            if (winLossRatioElement) {
                winLossRatioElement.textContent = `${winningTrades}:${losingTrades}`;
            }
            
            return {
                labels: ['Winning Trades', 'Losing Trades'],
                datasets: [{
                    data: [winningTrades, losingTrades],
                    backgroundColor: ['#10b981', '#ef4444'],
                    borderWidth: 0,
                    borderAlign: 'inner'
                }]
            };
        }

        function getWinRateData() {
            const winningTrades = trades.filter(t => t.pnl > 0).length;
            const losingTrades = trades.filter(t => t.pnl < 0).length;
            const breakEvenTrades = trades.filter(t => t.pnl === 0).length;
            
            return {
                labels: ['Winning Trades', 'Losing Trades', 'Break Even'],
                datasets: [{
                    data: [winningTrades, losingTrades, breakEvenTrades],
                    backgroundColor: ['#10b981', '#ef4444', '#94a3b8'],
                    borderWidth: 0
                }]
            };
        }

        function getWinLossData() {
            const winningTrades = trades.filter(t => t.pnl > 0);
            const losingTrades = trades.filter(t => t.pnl < 0);
            
            const totalProfit = winningTrades.reduce((sum, t) => sum + t.pnl, 0);
            const totalLoss = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));
            
            return {
                labels: ['Total Profit', 'Total Loss'],
                datasets: [{
                    data: [totalProfit, totalLoss],
                    backgroundColor: ['#10b981', '#ef4444'],
                    borderWidth: 0
                }]
            };
        }

        // ===== DASHBOARD INITIALIZATION =====
        function initializeApp() {
            console.log('Initializing FX Tae Trading Dashboard...');
            
            if (!sessionStorage.getItem(AUTH_KEY)) {
                window.location.href = 'index.html';
                return;
            }
            
            try {
                resetMonthlyData();
                
                loadTrades();
                loadDreams();
                loadAccountBalance();
                
                updateCurrentDate();
                updateUserInfo();
                updateAccountBalanceDisplay();
                updateRecentTrades();
                updateAllTrades();
                updateStats();
                updateTradeLists();
                updateDreamsList();
                
                setTimeout(() => {
                    initializeCharts();
                    updateCalendar();
                }, 500);
                
                setupEventListeners();
                
                const tradeDateInput = document.getElementById('tradeDate');
                if (tradeDateInput) {
                    tradeDateInput.value = new Date().toISOString().split('T')[0];
                }
                
                const tradeTimeInput = document.getElementById('tradeTime');
                if (tradeTimeInput) {
                    const now = new Date();
                    const hours = now.getHours().toString().padStart(2, '0');
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    tradeTimeInput.value = `${hours}:${minutes}`;
                }
                
                const savedTheme = localStorage.getItem('fxTaeTheme') || 'light';
                setTheme(savedTheme);
                
                console.log('Dashboard initialized successfully!');
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Error initializing application', 'error');
            }
        }

        function updateCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dateElement.textContent = now.toLocaleDateString('en-US', options);
            }
        }

        function updateUserInfo() {
            const user = JSON.parse(localStorage.getItem(CURRENT_USER_KEY) || '{}');
            if (user) {
                const userNameElement = document.getElementById('userName');
                const userEmailElement = document.getElementById('userEmail');
                
                if (userNameElement) userNameElement.textContent = user.name || 'Trader';
                if (userEmailElement) userEmailElement.textContent = user.email || 'trader@example.com';
            }
        }

        function updateAccountBalanceDisplay() {
            try {
                const balanceElement = document.getElementById('accountBalance');
                const currentBalanceInput = document.getElementById('currentBalanceInput');
                const startingBalanceElement = document.getElementById('startingBalance');
                const totalGrowthElement = document.getElementById('totalGrowth');
                const growthPercentageElement = document.getElementById('growthPercentage');
                
                const calculatedBalance = startingBalance + trades.reduce((sum, trade) => sum + trade.pnl, 0);
                accountBalance = calculatedBalance;
                
                if (balanceElement) {
                    balanceElement.textContent = formatCurrency(accountBalance);
                }
                
                if (currentBalanceInput) {
                    currentBalanceInput.value = accountBalance;
                }
                
                if (startingBalanceElement) {
                    startingBalanceElement.textContent = formatCurrency(startingBalance);
                }
                
                if (totalGrowthElement) {
                    const growth = accountBalance - startingBalance;
                    totalGrowthElement.textContent = formatCurrency(growth);
                    totalGrowthElement.className = `stat-value ${growth >= 0 ? 'profit' : 'loss'}`;
                }
                
                if (growthPercentageElement) {
                    const growthPercentage = startingBalance > 0 ? ((accountBalance - startingBalance) / startingBalance) * 100 : 0;
                    growthPercentageElement.textContent = `${growthPercentage >= 0 ? '+' : ''}${growthPercentage.toFixed(1)}%`;
                    growthPercentageElement.className = `stat-value ${growthPercentage >= 0 ? 'profit' : 'loss'}`;
                }
                
                saveAccountBalance();
            } catch (error) {
                console.error('Error updating account balance display:', error);
            }
        }

        function updateRecentTrades() {
            const tableBody = document.getElementById('recentTradesTable');
            if (!tableBody) return;
            
            try {
                const recentTrades = [...trades]
                    .sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time))
                    .slice(0, 5);
                
                if (recentTrades.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="no-trades">
                                <i class="fas fa-chart-line"></i>
                                <p>No trades recorded yet. Start trading to see your history here.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tableBody.innerHTML = recentTrades.map(trade => `
                    <tr>
                        <td>${formatDateTime(trade.date, trade.time)}</td>
                        <td>${trade.tradeNumber}</td>
                        <td>${trade.pair}</td>
                        <td>${trade.strategy}</td>
                        <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(trade.pnl)}</td>
                        <td><span class="status-badge ${trade.pnl >= 0 ? 'profit' : 'loss'}">${trade.pnl >= 0 ? 'WIN' : 'LOSS'}</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editTrade(${trade.id})" title="Edit Trade">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteTrade(${trade.id})" title="Delete Trade">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error updating recent trades:', error);
            }
        }

        function updateAllTrades() {
            const tableBody = document.getElementById('allTradesTable');
            if (!tableBody) return;
            
            try {
                const allTrades = [...trades].sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));
                
                if (allTrades.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8" class="no-trades">
                                <i class="fas fa-chart-line"></i>
                                <p>No trades recorded yet. Start trading to see your journal here.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tableBody.innerHTML = allTrades.map(trade => `
                    <tr>
                        <td>${formatDateTime(trade.date, trade.time)}</td>
                        <td>${trade.tradeNumber}</td>
                        <td>${trade.pair}</td>
                        <td>${trade.strategy}</td>
                        <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(trade.pnl)}</td>
                        <td>${trade.notes || 'No notes'}</td>
                        <td><span class="status-badge ${trade.pnl >= 0 ? 'profit' : 'loss'}">${trade.pnl >= 0 ? 'WIN' : 'LOSS'}</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editTrade(${trade.id})" title="Edit Trade">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteTrade(${trade.id})" title="Delete Trade">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error updating all trades:', error);
            }
        }

        function updateStats() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const todayTrades = trades.filter(t => t.date === today);
                const todayPnl = todayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                
                const todayPnlElement = document.getElementById('todayPnl');
                if (todayPnlElement) {
                    todayPnlElement.textContent = formatCurrencyWithSign(todayPnl);
                    todayPnlElement.className = `stat-value ${todayPnl >= 0 ? 'profit' : 'loss'}`;
                }
                
                const todayTradesCount = document.getElementById('todayTradesCount');
                if (todayTradesCount) {
                    todayTradesCount.textContent = `${todayTrades.length}/4`;
                }
                
                const progressFill = document.querySelector('.progress-fill');
                if (progressFill) {
                    const progress = (todayTrades.length / 4) * 100;
                    progressFill.style.width = `${progress}%`;
                }
                
                const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];
                const weeklyTrades = trades.filter(t => t.date >= weekAgo);
                const weeklyPnl = weeklyTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                
                const weeklyPnlElement = document.getElementById('weeklyPnl');
                if (weeklyPnlElement) {
                    weeklyPnlElement.textContent = formatCurrencyWithSign(weeklyPnl);
                    weeklyPnlElement.className = `stat-value ${weeklyPnl >= 0 ? 'profit' : 'loss'}`;
                }
                
                const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0];
                const monthlyTrades = trades.filter(t => t.date >= monthAgo);
                const monthlyPnl = monthlyTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                
                const monthlyPnlElement = document.getElementById('monthlyPnl');
                if (monthlyPnlElement) {
                    monthlyPnlElement.textContent = formatCurrencyWithSign(monthlyPnl);
                    monthlyPnlElement.className = `stat-value ${monthlyPnl >= 0 ? 'profit' : 'loss'}`;
                }
                
                updateWinRate();
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function updateWinRate() {
            try {
                const winningTrades = trades.filter(t => t.pnl > 0).length;
                const losingTrades = trades.filter(t => t.pnl < 0).length;
                const totalTrades = winningTrades + losingTrades;
                const winRate = totalTrades > 0 ? (winningTrades / totalTrades) * 100 : 0;
                
                const winRateElement = document.getElementById('winRateValue');
                if (winRateElement) {
                    winRateElement.textContent = `${winRate.toFixed(1)}%`;
                }
            } catch (error) {
                console.error('Error updating win rate:', error);
            }
        }

        function updateTradeLists() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const todayTrades = trades.filter(t => t.date === today);
                const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];
                const weeklyTrades = trades.filter(t => t.date >= weekAgo);
                const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0];
                const monthlyTrades = trades.filter(t => t.date >= monthAgo);
                
                updateTradeList('todayTradesList', todayTrades);
                updateTradeList('weeklyTradesList', weeklyTrades);
                updateTradeList('monthlyTradesList', monthlyTrades);
            } catch (error) {
                console.error('Error updating trade lists:', error);
            }
        }

        function updateTradeList(elementId, tradeList) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            try {
                if (tradeList.length === 0) {
                    element.innerHTML = '<p class="no-trades">No trades recorded</p>';
                    return;
                }
                
                const list = tradeList.slice(0, 3).map(trade => `
                    <div class="trade-item">
                        <span>${formatDateTime(trade.date, trade.time)}</span>
                        <span>${trade.pair}</span>
                        <span class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(trade.pnl)}</span>
                    </div>
                `).join('');
                
                element.innerHTML = list;
            } catch (error) {
                element.innerHTML = '<p class="no-trades">Error loading trades</p>';
            }
        }

        function updateDreamsList() {
            const dreamsList = document.getElementById('dreamsList');
            if (!dreamsList) return;
            
            try {
                if (dreams.length === 0) {
                    dreamsList.innerHTML = `
                        <div class="no-dreams">
                            <i class="fas fa-cloud"></i>
                            <p>No dreams recorded yet. Write your first trading dream!</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedDreams = [...dreams].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                dreamsList.innerHTML = sortedDreams.map(dream => `
                    <div class="dream-card">
                        <div class="dream-header">
                            <span class="dream-date">${formatDate(dream.date)}</span>
                            <div class="dream-actions">
                                <button class="action-btn edit-btn" onclick="editDream(${dream.id})" title="Edit Dream">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteDream(${dream.id})" title="Delete Dream">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="dream-content">${dream.content}</div>
                    </div>
                `).join('');
            } catch (error) {
                dreamsList.innerHTML = `
                    <div class="no-dreams">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Error loading dreams. Please refresh the page.</p>
                    </div>
                `;
            }
        }

        // ===== CHART FUNCTIONS =====
        function initializeCharts() {
            console.log('Initializing charts...');
            
            try {
                // Equity Chart
                const equityCtx = document.getElementById('equityChart');
                if (equityCtx) {
                    const equityData = getEquityData('7d');
                    
                    equityChart = new Chart(equityCtx, {
                        type: 'line',
                        data: equityData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `Balance: $${context.parsed.y.toLocaleString()}`;
                                        },
                                        title: function(context) {
                                            if (context[0].dataIndex === 0) return 'Starting Balance';
                                            return context[0].label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    },
                                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                                    title: {
                                        display: true,
                                        text: 'Account Balance ($)'
                                    }
                                },
                                x: {
                                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                                    title: {
                                        display: true,
                                        text: 'Date & Time'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Win Rate Chart
                const winRateCtx = document.getElementById('winRateChart');
                if (winRateCtx) {
                    const winRateData = getWinRateData();
                    
                    winRateChart = new Chart(winRateCtx, {
                        type: 'doughnut',
                        data: winRateData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                }
                
                // Win Loss Chart
                const winLossCtx = document.getElementById('winLossChart');
                if (winLossCtx) {
                    const winLossData = getWinLossData();
                    
                    winLossChart = new Chart(winLossCtx, {
                        type: 'pie',
                        data: winLossData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                }
                
                // Win/Loss Ratio Chart
                const winLossRatioCtx = document.getElementById('winLossRatioChart');
                if (winLossRatioCtx) {
                    const winLossRatioData = getWinLossRatioData();
                    
                    winLossRatioChart = new Chart(winLossRatioCtx, {
                        type: 'doughnut',
                        data: winLossRatioData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            circumference: 180,
                            rotation: -90,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20,
                                        usePointStyle: true,
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing charts:', error);
                showToast('Error initializing charts', 'error');
            }
        }

        // ===== TRADE FUNCTIONS =====
        function saveTrade() {
            try {
                const date = document.getElementById('tradeDate')?.value;
                const time = document.getElementById('tradeTime')?.value;
                const tradeNumber = parseInt(document.getElementById('tradeNumber')?.value);
                let strategy = document.getElementById('strategy')?.value;
                const customStrategy = document.getElementById('customStrategy')?.value;
                const pair = document.getElementById('currencyPair')?.value;
                const pnl = parseFloat(document.getElementById('pnlAmount')?.value);
                const notes = document.getElementById('tradeNotes')?.value;
                
                if (!date || !time || !tradeNumber || !strategy || !pair || isNaN(pnl)) {
                    showToast('Please fill all required fields', 'error');
                    return false;
                }
                
                const todayTrades = trades.filter(t => t.date === date);
                if (todayTrades.length >= 4) {
                    showToast('Maximum 4 trades per day reached!', 'error');
                    return false;
                }
                
                if (customStrategy && document.getElementById('customStrategy').style.display !== 'none') {
                    strategy = customStrategy;
                }
                
                const trade = {
                    id: Date.now(),
                    date,
                    time,
                    tradeNumber,
                    pair,
                    strategy,
                    pnl,
                    notes: notes || 'No notes provided'
                };
                
                trades.unshift(trade);
                saveTrades();
                
                updateAccountBalanceDisplay();
                updateRecentTrades();
                updateAllTrades();
                updateStats();
                updateTradeLists();
                
                if (equityChart) {
                    const activePeriodBtn = document.querySelector('.period-btn.active');
                    const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                    equityChart.data = getEquityData(period);
                    equityChart.update();
                }
                
                if (winRateChart) {
                    winRateChart.data = getWinRateData();
                    winRateChart.update();
                }
                
                if (winLossChart) {
                    winLossChart.data = getWinLossData();
                    winLossChart.update();
                }
                
                if (winLossRatioChart) {
                    winLossRatioChart.data = getWinLossRatioData();
                    winLossRatioChart.update();
                }
                
                updateCalendar();
                
                const pnlInput = document.getElementById('pnlAmount');
                const notesInput = document.getElementById('tradeNotes');
                
                if (pnlInput) pnlInput.value = '';
                if (notesInput) notesInput.value = '';
                
                showToast('Trade saved successfully!', 'success');
                return true;
            } catch (error) {
                console.error('Error saving trade:', error);
                showToast('Error saving trade', 'error');
                return false;
            }
        }

        function saveAndDownloadTrade() {
            const success = saveTrade();
            if (success) {
                setTimeout(() => {
                    if (trades.length > 0) {
                        downloadTradePDF(trades[0]);
                    }
                }, 500);
            }
        }

        function editTrade(tradeId) {
            const tradeIndex = trades.findIndex(t => t.id === tradeId);
            if (tradeIndex === -1) {
                showToast('Trade not found', 'error');
                return;
            }
            
            const trade = trades[tradeIndex];
            document.getElementById('editTradesModal').style.display = 'flex';
            
            const editList = document.getElementById('todayTradesEditList');
            editList.innerHTML = `
                <div class="edit-trade-form">
                    <div class="form-group">
                        <label>Trade #</label>
                        <input type="number" id="editTradeNumber" class="form-input" value="${trade.tradeNumber}" min="1" max="4">
                    </div>
                    <div class="form-group">
                        <label>Currency Pair</label>
                        <input type="text" id="editPair" class="form-input" value="${trade.pair}">
                    </div>
                    <div class="form-group">
                        <label>Strategy</label>
                        <input type="text" id="editStrategy" class="form-input" value="${trade.strategy}">
                    </div>
                    <div class="form-group">
                        <label>P&L ($)</label>
                        <input type="number" id="editPnl" class="form-input" value="${trade.pnl}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="editTime" class="form-input" value="${trade.time}">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="editNotes" class="form-input">${trade.notes}</textarea>
                    </div>
                    <input type="hidden" id="editTradeId" value="${trade.id}">
                </div>
            `;
        }

        function saveEditedTrades() {
            try {
                const tradeId = parseInt(document.getElementById('editTradeId').value);
                const tradeIndex = trades.findIndex(t => t.id === tradeId);
                
                if (tradeIndex === -1) {
                    showToast('Trade not found', 'error');
                    return;
                }
                
                trades[tradeIndex] = {
                    ...trades[tradeIndex],
                    tradeNumber: parseInt(document.getElementById('editTradeNumber').value),
                    pair: document.getElementById('editPair').value,
                    strategy: document.getElementById('editStrategy').value,
                    pnl: parseFloat(document.getElementById('editPnl').value),
                    time: document.getElementById('editTime').value,
                    notes: document.getElementById('editNotes').value
                };
                
                saveTrades();
                
                updateAccountBalanceDisplay();
                updateRecentTrades();
                updateAllTrades();
                updateStats();
                updateTradeLists();
                
                if (equityChart) {
                    const activePeriodBtn = document.querySelector('.period-btn.active');
                    const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                    equityChart.data = getEquityData(period);
                    equityChart.update();
                }
                
                if (winRateChart) {
                    winRateChart.data = getWinRateData();
                    winRateChart.update();
                }
                
                closeEditTradesModal();
                showToast('Trade updated successfully!', 'success');
            } catch (error) {
                console.error('Error saving edited trade:', error);
                showToast('Error updating trade', 'error');
            }
        }

        function deleteTrade(tradeId) {
            if (!confirm('Are you sure you want to delete this trade?')) return;
            
            const tradeIndex = trades.findIndex(t => t.id === tradeId);
            if (tradeIndex === -1) return;
            
            try {
                trades.splice(tradeIndex, 1);
                saveTrades();
                
                updateAccountBalanceDisplay();
                updateRecentTrades();
                updateAllTrades();
                updateStats();
                updateTradeLists();
                
                if (equityChart) {
                    const activePeriodBtn = document.querySelector('.period-btn.active');
                    const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                    equityChart.data = getEquityData(period);
                    equityChart.update();
                }
                
                if (winRateChart) {
                    winRateChart.data = getWinRateData();
                    winRateChart.update();
                }
                
                updateCalendar();
                
                showToast('Trade deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting trade:', error);
                showToast('Error deleting trade', 'error');
            }
        }

        function editTodayTrades() {
            const today = new Date().toISOString().split('T')[0];
            const todayTrades = trades.filter(t => t.date === today);
            
            if (todayTrades.length === 0) {
                showToast('No trades to edit today', 'warning');
                return;
            }
            
            document.getElementById('editTradesModal').style.display = 'flex';
            
            const editList = document.getElementById('todayTradesEditList');
            editList.innerHTML = todayTrades.map(trade => `
                <div class="edit-trade-item">
                    <div class="trade-info">
                        <strong>Trade ${trade.tradeNumber} (${trade.time})</strong>
                        <span>${trade.pair} - ${trade.strategy}</span>
                        <span class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(trade.pnl)}</span>
                    </div>
                    <div class="trade-actions">
                        <button class="action-btn edit-btn" onclick="editTrade(${trade.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteTrade(${trade.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function closeEditTradesModal() {
            document.getElementById('editTradesModal').style.display = 'none';
        }

        function showCustomStrategy() {
            const customStrategy = document.getElementById('customStrategy');
            if (customStrategy) {
                customStrategy.style.display = 'block';
                customStrategy.focus();
            }
        }

        // ===== DREAM FUNCTIONS =====
        function saveDream() {
            const dreamInput = document.getElementById('dreamInput');
            const content = dreamInput?.value.trim();
            
            if (!content) {
                showToast('Please write your dream first', 'error');
                return;
            }
            
            try {
                const dream = {
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    content: content
                };
                
                dreams.unshift(dream);
                saveDreams();
                updateDreamsList();
                
                if (dreamInput) dreamInput.value = '';
                showToast('Dream saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving dream:', error);
                showToast('Error saving dream', 'error');
            }
        }

        function clearDream() {
            const dreamInput = document.getElementById('dreamInput');
            if (dreamInput) dreamInput.value = '';
        }

        function editDream(dreamId) {
            const dream = dreams.find(d => d.id === dreamId);
            if (!dream) {
                showToast('Dream not found', 'error');
                return;
            }
            
            const dreamInput = document.getElementById('dreamInput');
            if (dreamInput) dreamInput.value = dream.content;
            
            try {
                dreams = dreams.filter(d => d.id !== dreamId);
                saveDreams();
                updateDreamsList();
                
                showToast('Dream loaded for editing', 'info');
            } catch (error) {
                console.error('Error editing dream:', error);
                showToast('Error loading dream for editing', 'error');
            }
        }

        function deleteDream(dreamId) {
            if (!confirm('Are you sure you want to delete this dream?')) return;
            
            try {
                dreams = dreams.filter(d => d.id !== dreamId);
                saveDreams();
                updateDreamsList();
                
                showToast('Dream deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting dream:', error);
                showToast('Error deleting dream', 'error');
            }
        }

        // ===== BALANCE FUNCTIONS =====
        function editStartingBalance() {
            const startingBalanceElement = document.getElementById('startingBalance');
            const startingBalanceInput = document.getElementById('startingBalanceInput');
            const editButton = document.querySelector('.edit-starting-balance-btn');
            const saveButton = document.getElementById('saveBalanceBtn');
            const cancelButton = document.getElementById('cancelBalanceBtn');
            
            if (!startingBalanceElement || !startingBalanceInput) return;
            
            if (editButton) editButton.style.display = 'none';
            startingBalanceElement.style.display = 'none';
            startingBalanceInput.style.display = 'block';
            if (saveButton) saveButton.style.display = 'flex';
            if (cancelButton) cancelButton.style.display = 'flex';
            
            startingBalanceInput.value = startingBalance;
            
            setTimeout(() => {
                startingBalanceInput.focus();
                startingBalanceInput.select();
            }, 100);
        }

        function saveStartingBalance() {
            const startingBalanceInput = document.getElementById('startingBalanceInput');
            const newStartingBalance = parseFloat(startingBalanceInput.value);
            
            if (isNaN(newStartingBalance) || newStartingBalance <= 0) {
                showToast('Please enter a valid starting balance (greater than 0)', 'error');
                startingBalanceInput.focus();
                return;
            }
            
            startingBalance = newStartingBalance;
            saveAccountBalance();
            updateAccountBalanceDisplay();
            
            if (equityChart) {
                const activePeriodBtn = document.querySelector('.period-btn.active');
                const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                equityChart.data = getEquityData(period);
                equityChart.update();
            }
            
            showToast(`Starting balance updated to ${formatCurrency(startingBalance)}`, 'success');
            hideEditMode();
        }

        function cancelStartingBalanceEdit() {
            const startingBalanceInput = document.getElementById('startingBalanceInput');
            if (startingBalanceInput) startingBalanceInput.value = startingBalance;
            hideEditMode();
        }

        function hideEditMode() {
            const startingBalanceElement = document.getElementById('startingBalance');
            const startingBalanceInput = document.getElementById('startingBalanceInput');
            const editButton = document.querySelector('.edit-starting-balance-btn');
            const saveButton = document.getElementById('saveBalanceBtn');
            const cancelButton = document.getElementById('cancelBalanceBtn');
            
            if (editButton) editButton.style.display = 'flex';
            if (startingBalanceElement) startingBalanceElement.style.display = 'block';
            if (startingBalanceInput) startingBalanceInput.style.display = 'none';
            if (saveButton) saveButton.style.display = 'none';
            if (cancelButton) cancelButton.style.display = 'none';
        }

        // ===== PDF EXPORT FUNCTIONS =====
        function generatePDF({ title, content, filename }) {
            try {
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    showToast('PDF library not loaded. Please check internet connection.', 'error');
                    return;
                }
                
                const pdf = new jsPDF();
                const pageWidth = pdf.internal.pageSize.width;
                const margin = 20;
                const contentWidth = pageWidth - (2 * margin);
                let yPosition = margin;
                
                pdf.setFontSize(24);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(40, 40, 150);
                pdf.text(title, margin, yPosition);
                yPosition += 15;
                
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(100, 100, 100);
                pdf.text(`Generated: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`, margin, yPosition);
                yPosition += 15;
                
                pdf.setDrawColor(200, 200, 200);
                pdf.line(margin, yPosition, pageWidth - margin, yPosition);
                yPosition += 10;
                
                pdf.setFontSize(11);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(0, 0, 0);
                
                const lines = pdf.splitTextToSize(content, contentWidth);
                
                for (let i = 0; i < lines.length; i++) {
                    if (yPosition > pdf.internal.pageSize.height - margin) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    
                    let line = lines[i];
                    if (line.includes('**')) {
                        const parts = line.split('**');
                        let xPos = margin;
                        
                        for (let j = 0; j < parts.length; j++) {
                            if (j % 2 === 0) {
                                pdf.setFont('helvetica', 'normal');
                                pdf.text(parts[j], xPos, yPosition);
                                xPos += pdf.getStringUnitWidth(parts[j]) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
                            } else {
                                pdf.setFont('helvetica', 'bold');
                                pdf.text(parts[j], xPos, yPosition);
                                xPos += pdf.getStringUnitWidth(parts[j]) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
                            }
                        }
                    } else {
                        pdf.text(line, margin, yPosition);
                    }
                    
                    yPosition += 7;
                }
                
                pdf.setFontSize(10);
                pdf.setTextColor(150, 150, 150);
                pdf.text('FX Tae Trading Dashboard - www.fxtaetrader.page.gd', margin, pdf.internal.pageSize.height - 10);
                
                pdf.save(filename);
                showToast(`PDF "${filename}" downloaded successfully!`, 'success');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showToast('Error generating PDF. Please try again.', 'error');
            }
        }

        function downloadTodayStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayTrades = trades.filter(t => t.date === today);
            const todayPnl = todayTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            const content = `
                **ACCOUNT SUMMARY:**
                Current Balance: ${formatCurrency(accountBalance)}
                Starting Balance: ${formatCurrency(startingBalance)}
                Today's P&L: ${formatCurrencyWithSign(todayPnl)}
                Today's Trades: ${todayTrades.length}/4
                
                **TRADES TODAY:**
                ${todayTrades.length > 0 ? todayTrades.map(t => `
                Trade ${t.tradeNumber} (${t.time}):
                - Pair: ${t.pair}
                - Strategy: ${t.strategy}
                - P&L: ${formatCurrencyWithSign(t.pnl)}
                - Notes: ${t.notes || 'No notes'}
                `).join('\n') : 'No trades recorded today.'}
            `;
            
            generatePDF({
                title: `Today's Trading Stats - ${today}`,
                content: content,
                filename: `today-stats-${today}.pdf`
            });
        }

        function downloadWeeklyStats() {
            const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];
            const weeklyTrades = trades.filter(t => t.date >= weekAgo);
            const weeklyPnl = weeklyTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            const content = `
                **WEEKLY REPORT (Last 7 Days)**
                Period: ${weekAgo} to ${new Date().toISOString().split('T')[0]}
                
                **ACCOUNT PERFORMANCE:**
                Current Balance: ${formatCurrency(accountBalance)}
                Starting Balance: ${formatCurrency(startingBalance)}
                Weekly P&L: ${formatCurrencyWithSign(weeklyPnl)}
                Total Trades: ${weeklyTrades.length}
                
                **WEEKLY TRADES:**
                ${weeklyTrades.length > 0 ? weeklyTrades.map(t => `
                ${t.date} ${t.time} - Trade ${t.tradeNumber}:
                - Pair: ${t.pair}
                - Strategy: ${t.strategy}
                - P&L: ${formatCurrencyWithSign(t.pnl)}
                - Status: ${t.pnl >= 0 ? 'WIN' : 'LOSS'}
                `).join('\n') : 'No trades recorded this week.'}
            `;
            
            generatePDF({
                title: 'Weekly Trading Performance Report',
                content: content,
                filename: `weekly-stats-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function downloadMonthlyStats() {
            const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0];
            const monthlyTrades = trades.filter(t => t.date >= monthAgo);
            const monthlyPnl = monthlyTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            const content = `
                **MONTHLY REPORT (Last 30 Days)**
                Period: ${monthAgo} to ${new Date().toISOString().split('T')[0]}
                
                **ACCOUNT PERFORMANCE:**
                Current Balance: ${formatCurrency(accountBalance)}
                Starting Balance: ${formatCurrency(startingBalance)}
                Monthly P&L: ${formatCurrencyWithSign(monthlyPnl)}
                Total Growth: ${formatCurrency(accountBalance - startingBalance)}
                Growth %: ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
                Total Trades: ${monthlyTrades.length}
            `;
            
            generatePDF({
                title: 'Monthly Trading Performance Report',
                content: content,
                filename: `monthly-stats-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function downloadTradePDF(trade) {
            const content = `
                **TRADE DETAILS:**
                Date: ${formatDate(trade.date)}
                Time: ${trade.time}
                Trade Number: ${trade.tradeNumber}
                Currency Pair: ${trade.pair}
                Strategy: ${trade.strategy}
                P&L: ${formatCurrencyWithSign(trade.pnl)}
                Notes: ${trade.notes}
                
                **ACCOUNT INFORMATION:**
                Current Balance: ${formatCurrency(accountBalance)}
                Starting Balance: ${formatCurrency(startingBalance)}
                Total Growth: ${formatCurrency(accountBalance - startingBalance)}
                Growth %: ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
            `;
            
            generatePDF({
                title: `Trade Details - ${trade.pair} - ${formatDate(trade.date)}`,
                content: content,
                filename: `trade-${trade.id}-${trade.date}.pdf`
            });
        }

        function exportJournalPDF() {
            const winningTrades = trades.filter(t => t.pnl > 0);
            const losingTrades = trades.filter(t => t.pnl < 0);
            const winRate = trades.length > 0 ? (winningTrades.length / trades.length * 100).toFixed(1) : 0;
            
            const content = `
                **COMPLETE TRADING JOURNAL**
                
                **ACCOUNT SUMMARY:**
                Current Balance: ${formatCurrency(accountBalance)}
                Starting Balance: ${formatCurrency(startingBalance)}
                Total Growth: ${formatCurrency(accountBalance - startingBalance)}
                Growth %: ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
                Total Trades: ${trades.length}
                
                **PERFORMANCE METRICS:**
                Winning Trades: ${winningTrades.length}
                Losing Trades: ${losingTrades.length}
                Win Rate: ${winRate}%
                Total Profit: ${formatCurrency(winningTrades.reduce((sum, t) => sum + t.pnl, 0))}
                Total Loss: ${formatCurrency(Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0)))}
                Net Profit: ${formatCurrency(trades.reduce((sum, t) => sum + t.pnl, 0))}
                
                **ALL TRADES (${trades.length} Total):**
                ${trades.map(t => `
                ${t.date} ${t.time} | Trade ${t.tradeNumber} | ${t.pair} | ${t.strategy} | 
                P&L: ${formatCurrencyWithSign(t.pnl)} | Notes: ${t.notes || 'No notes'}
                `).join('\n')}
            `;
            
            generatePDF({
                title: 'Complete Trading Journal - All Trades',
                content: content,
                filename: `trading-journal-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function exportAnalyticsPDF() {
            const winningTrades = trades.filter(t => t.pnl > 0);
            const losingTrades = trades.filter(t => t.pnl < 0);
            const totalProfit = winningTrades.reduce((sum, t) => sum + t.pnl, 0);
            const totalLoss = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));
            const winRate = trades.length > 0 ? (winningTrades.length / trades.length * 100).toFixed(1) : 0;
            
            const content = `
                **TRADING ANALYTICS REPORT**
                
                **PERFORMANCE OVERVIEW:**
                **Total Trades:** ${trades.length}
                **Winning Trades:** ${winningTrades.length}
                **Losing Trades:** ${losingTrades.length}
                **Win Rate:** ${winRate}%
                **Win/Loss Ratio:** ${winningTrades.length}:${losingTrades.length}
                
                **PROFIT ANALYSIS:**
                **Total Profit:** ${formatCurrency(totalProfit)}
                **Total Loss:** ${formatCurrency(totalLoss)}
                **Net Profit:** ${formatCurrency(totalProfit - totalLoss)}
                
                **ACCOUNT GROWTH:**
                **Starting Balance:** ${formatCurrency(startingBalance)}
                **Current Balance:** ${formatCurrency(accountBalance)}
                **Total Growth:** ${formatCurrency(accountBalance - startingBalance)}
                **Growth %:** ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
                
                **GENERATED ON:** ${new Date().toLocaleDateString()}
                **BY:** FX Tae Trading Dashboard
            `;
            
            generatePDF({
                title: 'Trading Analytics Report',
                content: content,
                filename: `analytics-report-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function exportAllDataPDF() {
            const winningTrades = trades.filter(t => t.pnl > 0);
            const losingTrades = trades.filter(t => t.pnl < 0);
            const winRate = trades.length > 0 ? (winningTrades.length / trades.length * 100).toFixed(1) : 0;
            
            const content = `
                **COMPLETE TRADING DATA EXPORT**
                
                **ACCOUNT INFORMATION:**
                **Current Balance:** ${formatCurrency(accountBalance)}
                **Starting Balance:** ${formatCurrency(startingBalance)}
                **Total Growth:** ${formatCurrency(accountBalance - startingBalance)}
                **Growth %:** ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
                
                **PERFORMANCE SUMMARY:**
                **Total Trades:** ${trades.length}
                **Winning Trades:** ${winningTrades.length}
                **Losing Trades:** ${losingTrades.length}
                **Win Rate:** ${winRate}%
                **Total Profit:** ${formatCurrency(winningTrades.reduce((sum, t) => sum + t.pnl, 0))}
                **Total Loss:** ${formatCurrency(Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0)))}
                **Net Profit:** ${formatCurrency(trades.reduce((sum, t) => sum + t.pnl, 0))}
                
                **ALL TRADES (${trades.length} Total):**
                ${trades.map(t => `
                **${formatDate(t.date)} ${t.time} | Trade ${t.tradeNumber}**
                Pair: ${t.pair}
                Strategy: ${t.strategy}
                P&L: ${formatCurrencyWithSign(t.pnl)}
                Notes: ${t.notes || 'No notes'}
                `).join('\n')}
                
                **TRADING DREAMS (${dreams.length} Total):**
                ${dreams.map(d => `
                **${formatDate(d.date)}:**
                ${d.content}
                `).join('\n')}
                
                **EXPORT DETAILS:**
                **Generated:** ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}
                **Total Records:** ${trades.length + dreams.length}
                **Software:** FX Tae Trading Dashboard
            `;
            
            generatePDF({
                title: 'Complete Trading Data Backup',
                content: content,
                filename: `complete-trading-data-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function exportDashboardPDF() {
            const today = new Date().toISOString().split('T')[0];
            const todayTrades = trades.filter(t => t.date === today);
            const todayPnl = todayTrades.reduce((sum, t) => sum + t.pnl, 0);
            const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];
            const weeklyTrades = trades.filter(t => t.date >= weekAgo);
            const weeklyPnl = weeklyTrades.reduce((sum, t) => sum + t.pnl, 0);
            const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0];
            const monthlyTrades = trades.filter(t => t.date >= monthAgo);
            const monthlyPnl = monthlyTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            const content = `
                **PROFESSIONAL TRADING DASHBOARD REPORT**
                
                **DASHBOARD SNAPSHOT:**
                **Report Date:** ${new Date().toLocaleDateString()}
                **Account Name:** ${JSON.parse(localStorage.getItem(CURRENT_USER_KEY) || '{}').name || 'Trader'}
                
                **ACCOUNT OVERVIEW:**
                **Current Balance:** ${formatCurrency(accountBalance)}
                **Starting Balance:** ${formatCurrency(startingBalance)}
                **Total Growth:** ${formatCurrency(accountBalance - startingBalance)}
                **Growth %:** ${((accountBalance - startingBalance) / startingBalance * 100).toFixed(1)}%
                
                **DAILY PERFORMANCE:**
                **Today's P&L:** ${formatCurrencyWithSign(todayPnl)}
                **Today's Trades:** ${todayTrades.length}/4
                **Daily Progress:** ${(todayTrades.length / 4 * 100).toFixed(0)}%
                
                **WEEKLY PERFORMANCE:**
                **Weekly P&L:** ${formatCurrencyWithSign(weeklyPnl)}
                **Weekly Trades:** ${weeklyTrades.length}
                **Avg Daily P&L:** ${weeklyTrades.length > 0 ? formatCurrency(weeklyPnl / 7) : '$0.00'}
                
                **MONTHLY PERFORMANCE:**
                **Monthly P&L:** ${formatCurrencyWithSign(monthlyPnl)}
                **Monthly Trades:** ${monthlyTrades.length}
                **Avg Daily P&L:** ${monthlyTrades.length > 0 ? formatCurrency(monthlyPnl / 30) : '$0.00'}
                
                **GENERATED BY:**
                FX Tae Trading Dashboard
                www.fxtaetrader.page.gd
                ${new Date().toLocaleDateString()}
            `;
            
            generatePDF({
                title: 'Professional Trading Dashboard Report',
                content: content,
                filename: `dashboard-report-${new Date().toISOString().split('T')[0]}.pdf`
            });
        }

        function downloadChartAsPDF(canvasId, chartName) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                showToast('Chart not found', 'error');
                return;
            }
            
            try {
                html2canvas(canvas, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                }).then(canvasImage => {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('landscape');
                    
                    pdf.setFontSize(20);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(40, 40, 150);
                    pdf.text(chartName, 20, 20);
                    
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 30);
                    
                    const imgData = canvasImage.toDataURL('image/png', 1.0);
                    const imgWidth = 250;
                    const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;
                    
                    pdf.addImage(imgData, 'PNG', 20, 40, imgWidth, imgHeight);
                    
                    pdf.setFontSize(10);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text('FX Tae Trading Dashboard - Professional Chart Export', 20, pdf.internal.pageSize.height - 10);
                    
                    pdf.save(`${chartName.toLowerCase().replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    showToast(`${chartName} downloaded as PDF`, 'success');
                }).catch(error => {
                    console.error('Error capturing chart:', error);
                    showToast('Error downloading chart. Please try again.', 'error');
                });
            } catch (error) {
                console.error('Error downloading chart as PDF:', error);
                showToast('Error downloading chart', 'error');
            }
        }

        // ===== CALENDAR FUNCTIONS =====
        function updateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarMonth = document.getElementById('calendarMonth');
            
            if (!calendarGrid || !calendarMonth) return;
            
            try {
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                  'July', 'August', 'September', 'October', 'November', 'December'];
                calendarMonth.textContent = `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
                
                const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
                const lastDay = new Date(currentCalendarYear, currentCalendarMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                let calendarHTML = `
                    <div class="calendar-header">Sun</div>
                    <div class="calendar-header">Mon</div>
                    <div class="calendar-header">Tue</div>
                    <div class="calendar-header">Wed</div>
                    <div class="calendar-header">Thu</div>
                    <div class="calendar-header">Fri</div>
                    <div class="calendar-header">Sat</div>
                `;
                
                for (let i = 0; i < startingDay; i++) {
                    calendarHTML += '<div class="calendar-day empty"></div>';
                }
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayTrades = trades.filter(t => t.date === dateStr);
                    const dayPnl = dayTrades.reduce((sum, t) => sum + t.pnl, 0);
                    
                    let dayClass = 'calendar-day';
                    let pnlClass = '';
                    let pnlText = '';
                    
                    if (dayTrades.length > 0) {
                        dayClass += dayPnl >= 0 ? ' profit' : ' loss';
                        pnlClass = dayPnl >= 0 ? 'profit' : 'loss';
                        pnlText = formatCurrencyWithSign(dayPnl);
                    }
                    
                    calendarHTML += `
                        <div class="${dayClass}" onclick="viewDayTrades('${dateStr}')">
                            <div class="calendar-date">${day}</div>
                            ${dayTrades.length > 0 ? `
                                <div class="calendar-pnl ${pnlClass}">${pnlText}</div>
                                <div class="calendar-trades">${dayTrades.length} trade(s)</div>
                            ` : ''}
                        </div>
                    `;
                }
                
                calendarGrid.innerHTML = calendarHTML;
            } catch (error) {
                console.error('Error updating calendar:', error);
            }
        }

        function changeCalendarMonth(direction) {
            currentCalendarMonth += direction;
            
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            } else if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            }
            
            updateCalendar();
        }

        function viewDayTrades(dateStr) {
            const dayTrades = trades.filter(t => t.date === dateStr);
            
            if (dayTrades.length === 0) {
                showToast('No trades on this date', 'info');
                return;
            }
            
            const date = new Date(dateStr);
            const dateFormatted = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const totalPnl = dayTrades.reduce((sum, t) => sum + t.pnl, 0);
            
            let tradesHTML = dayTrades.map(trade => `
                <div class="day-trade-item">
                    <strong>Trade ${trade.tradeNumber} (${trade.time})</strong>
                    <span>${trade.pair} - ${trade.strategy}</span>
                    <span class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(trade.pnl)}</span>
                </div>
            `).join('');
            
            const modalContent = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-calendar-day"></i> Trades on ${dateFormatted}</h3>
                        <button class="close-modal" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="day-summary">
                            <div class="summary-item">
                                <span>Total Trades:</span>
                                <strong>${dayTrades.length}</strong>
                            </div>
                            <div class="summary-item">
                                <span>Daily P&L:</span>
                                <strong class="${totalPnl >= 0 ? 'profit' : 'loss'}">${formatCurrencyWithSign(totalPnl)}</strong>
                            </div>
                        </div>
                        <div class="day-trades-list">
                            ${tradesHTML}
                        </div>
                        <div class="modal-actions">
                            <button class="btn-outline" onclick="closeModal()">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ===== THEME FUNCTIONS =====
        function setTheme(theme) {
            try {
                document.body.classList.toggle('dark-theme', theme === 'dark');
                localStorage.setItem('fxTaeTheme', theme);
                
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if ((theme === 'light' && btn.textContent.includes('Light')) || 
                        (theme === 'dark' && btn.textContent.includes('Dark'))) {
                        btn.classList.add('active');
                    }
                });
                
                showToast(`Switched to ${theme} theme`, 'success');
            } catch (error) {
                console.error('Error setting theme:', error);
            }
        }

        function clearAllData() {
            if (!confirm('WARNING: This will delete ALL your trading data, dreams, and reset your account. This action cannot be undone. Are you sure?')) {
                return;
            }
            
            try {
                localStorage.removeItem('fxTaeTrades');
                localStorage.removeItem('fxTaeDreams');
                localStorage.removeItem('fxTaeAccountBalance');
                localStorage.removeItem('fxTaeStartingBalance');
                
                trades = [];
                dreams = [];
                accountBalance = 10000;
                startingBalance = 10000;
                
                saveTrades();
                saveDreams();
                saveAccountBalance();
                
                updateAccountBalanceDisplay();
                updateRecentTrades();
                updateAllTrades();
                updateDreamsList();
                updateStats();
                updateTradeLists();
                updateCalendar();
                
                if (equityChart) {
                    const activePeriodBtn = document.querySelector('.period-btn.active');
                    const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                    equityChart.data = getEquityData(period);
                    equityChart.update();
                }
                
                if (winRateChart) {
                    winRateChart.data = getWinRateData();
                    winRateChart.update();
                }
                
                showToast('All data cleared successfully!', 'success');
            } catch (error) {
                console.error('Error clearing all data:', error);
                showToast('Error clearing data', 'error');
            }
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.style.display = 'none';
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                }, 300);
            }
        }

        function openEditBalanceModal() {
            const modal = document.getElementById('editBalanceModal');
            const newBalanceInput = document.getElementById('newBalanceInput');
            
            if (modal) modal.style.display = 'flex';
            if (newBalanceInput) newBalanceInput.value = accountBalance;
        }

        function closeEditBalanceModal() {
            const modal = document.getElementById('editBalanceModal');
            if (modal) modal.style.display = 'none';
        }

        function confirmBalanceUpdate() {
            const newBalanceInput = document.getElementById('newBalanceInput');
            const newBalance = parseFloat(newBalanceInput?.value);
            
            if (isNaN(newBalance) || newBalance <= 0) {
                showToast('Please enter a valid balance', 'error');
                return;
            }
            
            try {
                startingBalance = newBalance;
                saveAccountBalance();
                updateAccountBalanceDisplay();
                
                if (equityChart) {
                    const activePeriodBtn = document.querySelector('.period-btn.active');
                    const period = activePeriodBtn ? activePeriodBtn.getAttribute('data-period') : '7d';
                    equityChart.data = getEquityData(period);
                    equityChart.update();
                }
                
                closeEditBalanceModal();
                showToast('Starting balance updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating balance:', error);
                showToast('Error updating balance', 'error');
            }
        }

        // ===== EVENT LISTENERS SETUP =====
        function setupEventListeners() {
            const menuBtn = document.getElementById('menuBtn');
            const sidebar = document.getElementById('sidebar');
            
            if (menuBtn && sidebar) {
                menuBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('active');
                });
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                    
                    const pageId = this.getAttribute('data-page');
                    const pageElement = document.getElementById(pageId);
                    if (pageElement) {
                        pageElement.classList.add('active');
                    }
                    
                    if (window.innerWidth <= 768 && sidebar) {
                        sidebar.classList.remove('active');
                    }
                    
                    if (pageId === 'analytics') {
                        setTimeout(() => {
                            if (winLossChart) winLossChart.update();
                            if (winLossRatioChart) winLossRatioChart.update();
                        }, 100);
                    }
                });
            });
            
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.getAttribute('data-period');
                    updateChartPeriod(period);
                });
            });
            
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        sessionStorage.removeItem(AUTH_KEY);
                        localStorage.removeItem(CURRENT_USER_KEY);
                        window.location.href = 'index.html';
                    }
                });
            }
            
            window.addEventListener('click', function(e) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'flex') {
                            modal.style.display = 'none';
                        }
                    });
                }
            });
        }

        function updateChartPeriod(period) {
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-period') === period) {
                    btn.classList.add('active');
                }
            });
            
            if (equityChart) {
                equityChart.data = getEquityData(period);
                equityChart.update();
            }
            
            const periodLabel = period === '7d' ? '7 Days' : period === '1m' ? '1 Month' : '12 Months';
            showToast(`Showing equity curve for ${periodLabel}`, 'info');
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard page loaded');
            
            if (!sessionStorage.getItem(AUTH_KEY)) {
                window.location.href = 'index.html';
                return;
            }
            
            setTimeout(() => {
                const loader = document.getElementById('loader');
                const mainContainer = document.getElementById('mainContainer');
                
                if (loader && mainContainer) {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                        mainContainer.style.display = 'block';
                        initializeApp();
                    }, 500);
                } else {
                    initializeApp();
                }
            }, 2000);
        });

        // ===== GLOBAL EXPORTS =====
        window.initializeApp = initializeApp;
        window.saveTrade = saveTrade;
        window.saveAndDownloadTrade = saveAndDownloadTrade;
        window.editTrade = editTrade;
        window.saveEditedTrades = saveEditedTrades;
        window.deleteTrade = deleteTrade;
        window.editTodayTrades = editTodayTrades;
        window.closeEditTradesModal = closeEditTradesModal;
        window.showCustomStrategy = showCustomStrategy;
        window.saveDream = saveDream;
        window.clearDream = clearDream;
        window.editDream = editDream;
        window.deleteDream = deleteDream;
        window.editStartingBalance = editStartingBalance;
        window.saveStartingBalance = saveStartingBalance;
        window.cancelStartingBalanceEdit = cancelStartingBalanceEdit;
        window.openEditBalanceModal = openEditBalanceModal;
        window.closeEditBalanceModal = closeEditBalanceModal;
        window.confirmBalanceUpdate = confirmBalanceUpdate;
        window.downloadTodayStats = downloadTodayStats;
        window.downloadWeeklyStats = downloadWeeklyStats;
        window.downloadMonthlyStats = downloadMonthlyStats;
        window.downloadTradePDF = downloadTradePDF;
        window.exportJournalPDF = exportJournalPDF;
        window.exportAnalyticsPDF = exportAnalyticsPDF;
        window.exportAllDataPDF = exportAllDataPDF;
        window.exportDashboardPDF = exportDashboardPDF;
        window.downloadChartAsPDF = downloadChartAsPDF;
        window.changeCalendarMonth = changeCalendarMonth;
        window.viewDayTrades = viewDayTrades;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.setTheme = setTheme;
        window.clearAllData = clearAllData;
        window.updateChartPeriod = updateChartPeriod;
        window.showToast = showToast;
        window.formatCurrency = formatCurrency;
        window.formatCurrencyWithSign = formatCurrencyWithSign;
        window.formatDate = formatDate;

        console.log('Script loaded successfully');
    </script>
</body>
</html>
